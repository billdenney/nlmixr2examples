<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modifying nlmixr models by piping • nlmixr.examples</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modifying nlmixr models by piping">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nlmixr.examples</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Getting started</li>
    <li>
      <a href="https://nlmixrdevelopment.github.io/nlmixr/articles/running_nlmixr.html">Introduction to Running Nlmixr</a>
    </li>
    <li>
      <a href="../articles/multiple-endpoints.html">Using Multiple Endpoints in Nlmixr</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Going further</li>
    <li>
      <a href="https://nlmixrdevelopment.github.io/nlmixr/articles/modelPiping.html">Model Piping</a>
    </li>
    <li>
      <a href="https://nlmixrdevelopment.github.io/nlmixr/articles/broom.html">Sweeping models to tidy datasets (broom)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-chalkboard-teacher"></span>
     
    Example models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/addingCovariances.html">Phenobarbatol with correlations</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Page 2018</li>
    <li>
      <a href="../articles/nimo.html">Nonlinear PK/PD -- Nimotuzumab</a>
    </li>
    <li>
      <a href="../articles/mavoglurant.html">PBPK -- Mavoglurant</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr/raw/master/CheatSheet_nlmixr.pdf">
    <span class="fa fa-scroll fa-lg"></span>
     
    Cheat Sheet
  </a>
</li>
<li>
  <a href="https://nlmixrdevelopment.github.io/nlmixr/reference/index.html">
    <span class="fa fa-file-code-o fa-lg"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/nlmixr/releases">
    <span class="fa fa-download"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Modifying nlmixr models by piping</h1>
            
            <h4 class="date">2019-10-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixrdevelopment/nlmixr/blob/master/vignettes/modelPiping.Rmd"><code>vignettes/modelPiping.Rmd</code></a></small>
      <div class="hidden name"><code>modelPiping.Rmd</code></div>

    </div>

    
    
<div class="figure">
<img src="logo.png" alt="nlmixr"><p class="caption">nlmixr</p>
</div>
<div id="changing-models-via-piping" class="section level1">
<h1 class="hasAnchor">
<a href="#changing-models-via-piping" class="anchor"></a>Changing models via piping</h1>
<p>As in the running nlmixr vignette, Let’s start with a very simple PK example, using the single-dose theophylline dataset generously provided by Dr. Robert A. Upton of the University of California, San Francisco:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nlmixr)

one.compartment &lt;-<span class="st"> </span><span class="cf">function</span>() {
    <span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>({
        tka &lt;-<span class="st"> </span><span class="fl">0.45</span> <span class="co"># Log Ka</span>
        tcl &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># Log Cl</span>
        ## This works with interactive models
        ## You may also label the preceding line with label("label text")
        tv &lt;-<span class="st"> </span><span class="fl">3.45</span>; <span class="co"># log V</span>
        ## the label("Label name") works with all models
        eta.ka <span class="op">~</span><span class="st"> </span><span class="fl">0.6</span>
        eta.cl <span class="op">~</span><span class="st"> </span><span class="fl">0.3</span>
        eta.v <span class="op">~</span><span class="st"> </span><span class="fl">0.1</span>
        add.sd &lt;-<span class="st"> </span><span class="fl">0.7</span>
    })
    <span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/model.html">model</a></span>({
        ka &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tka <span class="op">+</span><span class="st"> </span>eta.ka)
        cl &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tcl <span class="op">+</span><span class="st"> </span>eta.cl)
        v &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tv <span class="op">+</span><span class="st"> </span>eta.v)
        d<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/stats/TDist.html">dt</a></span>(depot) =<span class="st"> </span><span class="op">-</span>ka <span class="op">*</span><span class="st"> </span>depot
        d<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/stats/TDist.html">dt</a></span>(center) =<span class="st"> </span>ka <span class="op">*</span><span class="st"> </span>depot <span class="op">-</span><span class="st"> </span>cl <span class="op">/</span><span class="st"> </span>v <span class="op">*</span><span class="st"> </span>center
        cp =<span class="st"> </span>center <span class="op">/</span><span class="st"> </span>v 
        cp <span class="op">~</span><span class="st"> </span><span class="kw">add</span>(add.sd)
    })
}</code></pre></div>
<p>We can try the First-Order Conditional Estimation with Interaction (FOCEi) method to find a good solution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(one.compartment, theo_sd, <span class="dt">est=</span><span class="st">"focei"</span>,
              <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">npde=</span><span class="ot">TRUE</span>, <span class="dt">cwres=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-one.compartment-theo_sd-focei-4f8f8bca749c4d06589e930ab21c1524.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(fit)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.8134 373.4132 393.5928      -179.7066         1602.168</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 68.25185 0.316615   0.316616 0.009 0.584 1.782917</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ──────────────────────</span>
<span class="co">#&gt; Registered S3 method overwritten by 'R.oo':</span>
<span class="co">#&gt;   method        from       </span>
<span class="co">#&gt;   throw.default R.methodsS3</span>
<span class="co">#&gt;        Parameter  Est.     SE  %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka 0.478    0.2  41.8       1.61 (1.09, 2.39)     69.3</span>
<span class="co">#&gt; tcl       Log Cl  1.01  0.806  79.6      2.75 (0.567, 13.4)     26.9</span>
<span class="co">#&gt; tv         log V  3.46 0.0264 0.762       31.8 (30.2, 33.5)     13.9</span>
<span class="co">#&gt; add.sd           0.695                                0.695         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka        0.765% </span>
<span class="co">#&gt; tcl         4.25% </span>
<span class="co">#&gt; tv          10.5% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.391  0     0.74   1.06   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.30 -0.459 -0.242  3.85 -1.01  -1.45   3.26</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.88  0.692  0.366  6.79 -0.216 -0.311  5.83</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="changing-and-fixing-parameter-values-in-models" class="section level1">
<h1 class="hasAnchor">
<a href="#changing-and-fixing-parameter-values-in-models" class="anchor"></a>Changing and fixing parameter values in models</h1>
<p>Something that you may want to do is change initial estimates with a model. It is simple to modify the model definition and change them yourself, but you may also want to change them in a specific way; For example try a range of starting values to see how the system behaves (either by full estimation or by a posthoc estimation). In these situations it can be come tedious to modify the models by hand.</p>
<p>nlmixr provides the ability to:</p>
<ol style="list-style-type: decimal">
<li>Change parameter estimates before or after running a model. (ie <code><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini(tka=0.5)</a></code>)</li>
<li>Fix parameters to arbitrary values, or estimated values (ie <code><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini(tka=fix(0.5))</a></code> or <code><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini(tka=fix)</a></code>)</li>
</ol>
<p>The easiest way to illustrate this is by showing a few examples of piping changes to the model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Example 1 -- Set inital estimate to 0.5 (shown w/posthoc)
one.ka.<span class="fl">0.5</span> &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">tka=</span><span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"posthoc"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(one.ka.<span class="fl">0.5</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Example 2 -- Fix tka to 0.5 and re-estimate.
one.ka.<span class="fl">0.5</span> &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">tka=</span><span class="kw"><a href="https://rdrr.io/r/utils/fix.html">fix</a></span>(<span class="fl">0.5</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-one.compartment-theo_sd-focei-349ca039091a2f8a86f95795252ba69b.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Using S matrix to calculate</span>
<span class="co">#&gt; covariance, can check sandwich or R matrix with $covRS and $covR</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(one.ka.<span class="fl">0.5</span>)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.8456 371.4453 388.7422      -179.7227         17.80523</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 0.292732 0.180076   0.180077  0.01 0.169 0.344115</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;        Parameter  Est.    SE  %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka   0.5 FIXED FIXED                    1.65     69.3</span>
<span class="co">#&gt; tcl       Log Cl  1.01 0.314    31        2.75 (1.49, 5.1)     26.9</span>
<span class="co">#&gt; tv         log V  3.46 0.174  5.02       31.8 (22.6, 44.8)     13.9</span>
<span class="co">#&gt; add.sd           0.695                               0.695         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka        0.718% </span>
<span class="co">#&gt; tcl         4.26% </span>
<span class="co">#&gt; tv          10.4% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.391  0     0.74   1.06   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.36 -0.517 -0.273  3.85 -1.01  -1.45   3.33</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.95  0.616  0.325  6.79 -0.219 -0.315  5.91</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Example 3 -- Fix tka to model estimated value and re-estimate.
one.ka.<span class="fl">0.5</span> &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">tka=</span>fix) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-one.compartment-theo_sd-focei-21a36229fe39fc3dec414516ef1168f9.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(one.ka.<span class="fl">0.5</span>)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.8138 371.4135 388.7104      -179.7068         23328.59</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 0.291699 0.174106   0.174107 0.011 0.171 0.353088</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;        Parameter  Est.    SE  %RSE   Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka 0.478 FIXED FIXED                      1.61     69.3</span>
<span class="co">#&gt; tcl       Log Cl  1.01  5.46   539 2.75 (6.21e-05, 1.22e+05)     26.9</span>
<span class="co">#&gt; tv         log V  3.46 0.274  7.92         31.8 (18.6, 54.5)     13.9</span>
<span class="co">#&gt; add.sd           0.695                                 0.695         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka        0.756% </span>
<span class="co">#&gt; tcl         4.16% </span>
<span class="co">#&gt; tv          10.4% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.391  0     0.74   1.06   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.30 -0.457 -0.241  3.85 -1.01  -1.45   3.26</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.87  0.696  0.367  6.79 -0.216 -0.311  5.82</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Example 4 -- Change tka to 0.7 in orginal model function and then estimate
one.ka.<span class="fl">0.7</span> &lt;-<span class="st"> </span>one.compartment <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">tka=</span><span class="fl">0.7</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(theo_sd, <span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-focei-9d910ea1d773f6fba30d385ffbbe214d.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(one.ka.<span class="fl">0.7</span>)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;          OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.807 373.4067 393.5863      -179.7034         65.41897</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 0.292687 0.307789    0.30779 0.009 0.166 1.084734</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;        Parameter  Est.     SE %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka 0.471  0.201 42.6        1.6 (1.08, 2.37)     69.7</span>
<span class="co">#&gt; tcl       Log Cl  1.01 0.0746 7.39       2.75 (2.37, 3.18)     26.7</span>
<span class="co">#&gt; tv         log V  3.46 0.0467 1.35         31.8 (29, 34.9)     13.9</span>
<span class="co">#&gt; add.sd           0.694                               0.694         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka         1.14% </span>
<span class="co">#&gt; tcl         3.71% </span>
<span class="co">#&gt; tv          10.1% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.391  0     0.74   1.07   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.28 -0.440 -0.232  3.85 -1.01  -1.45   3.24</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.85  0.718  0.379  6.79 -0.216 -0.311  5.80</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="changing-model-features" class="section level1">
<h1 class="hasAnchor">
<a href="#changing-model-features" class="anchor"></a>Changing model features</h1>
<p>When developing models, often you add and remove between subject variability to parameters, add covariates to the effects, and/or change the residual errors. You can change lines in the model by piping the fit or the nlmixr model specification function to a <code>model</code></p>
<div id="adding-or-removing-between-subject-variability" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-or-removing-between-subject-variability" class="anchor"></a>Adding or Removing between subject variability</h2>
<p>Often in developing a model you add and remove between subject variability to certain model parameters. For example, you could remove the between subject variability in the ka parameter by changing that line in the model;</p>
<p>For example to remove a eta from a prior fit or prior model specification function, simply pipe it to the model function. You can then re-estimate by piping it to the <code>nlmixr</code> function again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Remove eta.ka on ka
noEta &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/model.html">model</a></span>(ka &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tka)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-focei-af8778c2b27916c973abb270429c96be.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(noEta)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 176.5817 431.1815 448.4783      -209.5907         36.00378</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 61.34481 0.208731   0.208732 0.009 0.444 0.594724</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;        Parameter  Est.     SE %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka  0.43  0.172 40.1        1.54 (1.1, 2.15)         </span>
<span class="co">#&gt; tcl       Log Cl 0.991 0.0744 7.51       2.69 (2.33, 3.12)     30.3</span>
<span class="co">#&gt; tv         log V  3.48 0.0486  1.4       32.3 (29.4, 35.6)     15.4</span>
<span class="co">#&gt; add.sd            1.02                                1.02         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka               </span>
<span class="co">#&gt; tcl         7.78% </span>
<span class="co">#&gt; tv          7.34% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     relative convergence (4) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 24</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.708  0     0.74   0.725  0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.12 -0.282 -0.270  3.57 -0.726 -0.712  3.09</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.62  0.950  0.910  6.44  0.125  0.123  5.57</span>
<span class="co">#&gt; # … with 129 more rows, and 13 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;, cp &lt;dbl&gt;,</span>
<span class="co">#&gt; #   depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;, NPDE &lt;dbl&gt;</span></code></pre></div>
<p>Of course you could also add an eta on a parameter in the same way;</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">addBackKa &lt;-<span class="st"> </span>noEta <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/model.html">model</a></span>({ka &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tka <span class="op">+</span><span class="st"> </span>bsv.ka)}) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">bsv.ka=</span><span class="fl">0.1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-focei-d496c0a076be10a5dec657694e1ac4d7.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Using S matrix to calculate</span>
<span class="co">#&gt; covariance, can check sandwich or R matrix with $covRS and $covR</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(addBackKa)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.8049 373.4047 393.5843      -179.7023         23.34314</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 73.76182   0.3704   0.370403 0.009 0.443 1.847376</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;        Parameter  Est.    SE %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka       Log Ka 0.462 0.394 85.2      1.59 (0.734, 3.43)     69.9</span>
<span class="co">#&gt; tcl       Log Cl  1.01 0.312 30.8        2.76 (1.5, 5.08)     26.8</span>
<span class="co">#&gt; tv         log V  3.46 0.175 5.06       31.8 (22.6, 44.8)     13.8</span>
<span class="co">#&gt; add.sd           0.695                              0.695         </span>
<span class="co">#&gt;        Shrink(SD)%</span>
<span class="co">#&gt; tka         1.38% </span>
<span class="co">#&gt; tcl         3.87% </span>
<span class="co">#&gt; tv          10.2% </span>
<span class="co">#&gt; add.sd             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.375  0     0.74   1.06   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.26 -0.419 -0.213  3.85 -1.01  -1.45   3.21</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.83  0.744  0.377  6.78 -0.215 -0.309  5.77</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, bsv.ka &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
<p>You can see the name change by examining the <code>omega</code> matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">addBackKa<span class="op">$</span>omega
<span class="co">#&gt;            eta.cl      eta.v    bsv.ka</span>
<span class="co">#&gt; eta.cl 0.06929604 0.00000000 0.0000000</span>
<span class="co">#&gt; eta.v  0.00000000 0.01894748 0.0000000</span>
<span class="co">#&gt; bsv.ka 0.00000000 0.00000000 0.3981419</span></code></pre></div>
<p>Note that new between subject variability parameters are distinguished from other types of parameters (ie population parameters, and individual covariates) by their name. Parameters starting or ending with the following names are assumed to be between subject variability parameters:</p>
<ul>
<li>eta (from NONMEM convention)</li>
<li>ppv (per patient variability)</li>
<li>psv (per subject variability)</li>
<li>iiv (inter-individual variability)</li>
<li>bsv (between subject variability)</li>
<li>bpv (between patient variability)</li>
</ul>
</div>
<div id="adding-covariate-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-covariate-effects" class="anchor"></a>Adding Covariate effects</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Note currently cov is needed as a prefix so nlmixr knows this is an
## estimated parameter not a parameter
wt70 &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span>## <span class="al">FIXME</span> could be based on if it finds the covarite in the last used nlmixr data.
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/model.html">model</a></span>({cl &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(tcl <span class="op">+</span><span class="st"> </span>eta.cl)<span class="op">*</span>(WT<span class="op">/</span><span class="dv">70</span>)<span class="op">^</span>covWtPow}) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">covWtPow=</span><span class="kw"><a href="https://rdrr.io/r/utils/fix.html">fix</a></span>(<span class="fl">0.75</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-focei-0229bb4e4f7e0cc4487881066a7b7ef6.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(wt70)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;           OBJF      AIC    BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 116.1807 372.7804 392.96      -179.3902         53.73413</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;           setup optimize covariance table npde    other</span>
<span class="co">#&gt; elapsed 69.1849 0.350975   0.350976  0.01 0.44 0.657146</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;          Parameter  Est.     SE  %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka         Log Ka 0.478  0.202  42.3        1.61 (1.08, 2.4)     69.3</span>
<span class="co">#&gt; tcl         Log Cl  1.02 0.0767  7.56       2.76 (2.37, 3.21)     26.8</span>
<span class="co">#&gt; tv           log V  3.46 0.0429  1.24       31.8 (29.2, 34.6)     13.9</span>
<span class="co">#&gt; add.sd             0.695                                0.695         </span>
<span class="co">#&gt; covWtPow            0.75  FIXED FIXED                    0.75         </span>
<span class="co">#&gt;          Shrink(SD)%</span>
<span class="co">#&gt; tka           1.27% </span>
<span class="co">#&gt; tcl           6.73% </span>
<span class="co">#&gt; tv            12.3% </span>
<span class="co">#&gt; add.sd              </span>
<span class="co">#&gt; covWtPow             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     false convergence (8) </span>
<span class="co">#&gt;   In an ODE system, false convergence may mean "useless" evaluations were performed.</span>
<span class="co">#&gt;   See https://tinyurl.com/yyrrwkce</span>
<span class="co">#&gt;   It could also mean the convergence is poor, check results before accepting fit</span>
<span class="co">#&gt;   You may also try a good derivative free optimization:</span>
<span class="co">#&gt;     nlmixr(...,control=list(outerOpt="bobyqa"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 26</span>
<span class="co">#&gt;   ID     TIME    DV  EVID    WT  PRED    RES   WRES IPRED   IRES  IWRES</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  79.6  0     0.74   0.391  0     0.74   1.06 </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  79.6  3.30 -0.458 -0.242  3.84 -1.00  -1.44 </span>
<span class="co">#&gt; 3 1     0.570  6.57     0  79.6  5.87  0.704  0.372  6.78 -0.214 -0.308</span>
<span class="co">#&gt; # … with 129 more rows, and 15 more variables: CPRED &lt;dbl&gt;, CRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CWRES &lt;dbl&gt;, eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cl &lt;dbl&gt;, v &lt;dbl&gt;, cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;,</span>
<span class="co">#&gt; #   ERES &lt;dbl&gt;, NPDE &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="changing-residual-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#changing-residual-errors" class="anchor"></a>Changing residual errors</h2>
<p>Changing the residual errors is also just as easy, by simply specifying the error you wish to change:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Since there are 0 predictions in the data, these are changed to
## 0.0150 to show proportional error change.
d &lt;-<span class="st"> </span>theo_sd
d<span class="op">$</span>DV[d<span class="op">$</span>EVID <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>d<span class="op">$</span>DV <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="fl">0.0150</span>

addPropModel &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/model.html">model</a></span>({cp <span class="op">~</span><span class="st"> </span><span class="kw">add</span>(add.err)<span class="op">+</span><span class="kw">prop</span>(prop.err)}) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/ini.html">ini</a></span>(<span class="dt">prop.err=</span><span class="fl">0.1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/nlmixr/man/nlmixr.html">nlmixr</a></span>(d,<span class="dt">est=</span><span class="st">"focei"</span>, <span class="dt">table=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">cwres=</span><span class="ot">TRUE</span>, <span class="dt">npde=</span><span class="ot">TRUE</span>))
<span class="co">#&gt; Loading model already run (/tmp/RtmpXKdUFj/temp_libpath58be457a881a/nlmixr.examples/nlmixr-focei-ba25fc535079c939b160f115e233611e.rds)</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ID missing in parameters dataset;</span>
<span class="co">#&gt;  Parameters are assumed to have the same order as the IDs in the event dataset</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Initial ETAs were nudged; (Can</span>
<span class="co">#&gt; control by foceiControl(etaNudge=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): ETAs were reset to zero during</span>
<span class="co">#&gt; optimization; (Can control by foceiControl(resetEtaP=.))</span>
<span class="co">#&gt; Warning in lapply(X = X, FUN = FUN, ...): Gradient problems with initial</span>
<span class="co">#&gt; estimate and covariance; see $scaleInfo</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(addPropModel)
<span class="co">#&gt; ── nlmixr FOCE[31;1mi[0m (outer: nlminb) fit ─────────────────────────────────────── </span>
<span class="co">#&gt;          OBJF      AIC      BIC Log-likelihood Condition Number</span>
<span class="co">#&gt; FOCEi 104.367 362.9668 386.0292      -173.4834         55.33045</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Time (sec; $time): ───────────────────────────────────────────────────── </span>
<span class="co">#&gt;            setup optimize covariance table  npde    other</span>
<span class="co">#&gt; elapsed 68.89616 0.322668   0.322669  0.01 0.441 4.494507</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Population Parameters ($parFixed or $parFixedDf): ────────────────────── </span>
<span class="co">#&gt;          Parameter  Est.     SE %RSE Back-transformed(95%CI) BSV(CV%)</span>
<span class="co">#&gt; tka         Log Ka 0.397  0.199 50.2        1.49 (1.01, 2.2)     69.1</span>
<span class="co">#&gt; tcl         Log Cl  1.02 0.0714 6.97        2.79 (2.42, 3.2)     25.9</span>
<span class="co">#&gt; tv           log V  3.46  0.051 1.47         32 (28.9, 35.3)     12.7</span>
<span class="co">#&gt; add.err            0.283                               0.283         </span>
<span class="co">#&gt; prop.err           0.132                               0.132         </span>
<span class="co">#&gt;          Shrink(SD)%</span>
<span class="co">#&gt; tka           2.01% </span>
<span class="co">#&gt; tcl           1.33% </span>
<span class="co">#&gt; tv            15.4% </span>
<span class="co">#&gt; add.err             </span>
<span class="co">#&gt; prop.err             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Covariance Type ($covMethod): r,s</span>
<span class="co">#&gt;   No correlations in between subject variability (BSV) matrix</span>
<span class="co">#&gt;   Full BSV covariance ($omega) or correlation ($omegaR; diagonals=SDs) </span>
<span class="co">#&gt;   Distribution stats (mean/skewness/kurtosis/p-value) available in $shrink </span>
<span class="co">#&gt;   Minimization message ($message):  </span>
<span class="co">#&gt;     relative convergence (4) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Fit Data (object is a modified tibble): ──────────────────────────────── </span>
<span class="co">#&gt; # A tibble: 132 x 25</span>
<span class="co">#&gt;   ID     TIME    DV  EVID  PRED    RES   WRES IPRED   IRES  IWRES CPRED</span>
<span class="co">#&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 1     0      0.74     0  0     0.74   0.396  0     0.74   2.62   0   </span>
<span class="co">#&gt; 2 1     0.25   2.84     0  3.07 -0.233 -0.124  3.47 -0.631 -1.18   3.05</span>
<span class="co">#&gt; 3 1     0.570  6.57     0  5.56  1.01   0.528  6.24  0.326  0.375  5.54</span>
<span class="co">#&gt; # … with 129 more rows, and 14 more variables: CRES &lt;dbl&gt;, CWRES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   eta.ka &lt;dbl&gt;, eta.cl &lt;dbl&gt;, eta.v &lt;dbl&gt;, ka &lt;dbl&gt;, cl &lt;dbl&gt;, v &lt;dbl&gt;,</span>
<span class="co">#&gt; #   cp &lt;dbl&gt;, depot &lt;dbl&gt;, center &lt;dbl&gt;, EPRED &lt;dbl&gt;, ERES &lt;dbl&gt;,</span>
<span class="co">#&gt; #   NPDE &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#changing-models-via-piping">Changing models via piping</a></li>
      <li><a href="#changing-and-fixing-parameter-values-in-models">Changing and fixing parameter values in models</a></li>
      <li>
<a href="#changing-model-features">Changing model features</a><ul class="nav nav-pills nav-stacked">
<li><a href="#adding-or-removing-between-subject-variability">Adding or Removing between subject variability</a></li>
      <li><a href="#adding-covariate-effects">Adding Covariate effects</a></li>
      <li><a href="#changing-residual-errors">Changing residual errors</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew Fidler, Yuan Xiong, Rik Schoemaker, Justin Wilkins, Mirjam Trame, Richard Hooijmaijers, Teun Post, Wenping Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
